- name: allowed-queries
  definition:
    queries:
    - name: users
      query: |-
        query MyQuery {
          user(where: {active: {_eq: true}}) {
            email
            email_confirmed
            group {
              id
              is_school
              name
            }
            id
            manager
            name
          }
        }
    - name: signup
      query: |-
        mutation Signup($email: String!, $password: String!) {
          signup(email: $email, password: $password) {
            errorKnownEmail
            errorWeakPassword
            group
            id
            token
          }
        }
    - name: login
      query: |-
        mutation Login($email: String!, $password: String!) {
          login(email: $email, password: $password) {
            id
            token
            group_id
            error
          }
        }
    - name: students
      query: |-
        query Student {
          student(order_by: {fullname: {fullname: asc}}, where: {active: {_eq: true}}) {
            birthdate
            cycle
            firstname
            group_id
            id
            lastname
            school_entry
          }
        }
    - name: socle
      query: |-
        query Socle {
          domains: socle_domain {
            id
            rank
            title
          }
          components: socle_component {
            id
            rank
            title
          }
          competencies: socle_competency {
            text
            rank
            id
            cycle
          }
          subjects: socle_subject {
            id
            title
          }
          c1: socle_domain(order_by: {rank: asc}) {
            id
            components(order_by: {rank: asc}) {
              id
              competencies(where: {cycle: {_eq: "c1"}}, order_by: {rank: asc}) {
                id
                subjects {
                  subject {
                    id
                  }
                }
              }
            }
          }
          c2: socle_domain(order_by: {rank: asc}) {
            id
            components(order_by: {rank: asc}) {
              id
              competencies(where: {cycle: {_eq: "c2"}}, order_by: {rank: asc}) {
                id
                subjects {
                  subject {
                    id
                  }
                }
              }
            }
          }
          c3: socle_domain(order_by: {rank: asc}) {
            id
            components(order_by: {rank: asc}) {
              id
              competencies(where: {cycle: {_eq: "c3"}}, order_by: {rank: asc}) {
                id
                subjects {
                  subject {
                    id
                  }
                }
              }
            }
          }
          c4: socle_domain(order_by: {rank: asc}) {
            id
            components(order_by: {rank: asc}) {
              id
              competencies(where: {cycle: {_eq: "c4"}}, order_by: {rank: asc}) {
                id
                subjects {
                  subject {
                    id
                  }
                }
              }
            }
          }
        }
    - name: insert-observation
      query: |-
        mutation InsertEvalObservation($text: String!, $user_id: bigint!) {
          insert_eval_observation_one(object: {text: $text, user_id: $user_id}) {
            id
            created_at
          }
        }
